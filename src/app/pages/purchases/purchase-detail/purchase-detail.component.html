<mat-drawer-container *ngIf="isLoading$ | async">
    <mat-drawer mode="side" opened position="start" class="hide-on-mobile">
        <div class="label">
            <label>Usuário:</label>
            <div>
                <ngx-skeleton-loader appearance="line"
                    [theme]="{height: '15px', width: '150px', 'margin-bottom': 0}">
                </ngx-skeleton-loader>
            </div>
        </div>
        <div class="label">
            <label>Criado em:</label>
            <div>
                <ngx-skeleton-loader appearance="line"
                    [theme]="{height: '15px', width: '150px', 'margin-bottom': 0}">
                </ngx-skeleton-loader>
            </div>
        </div>
        <div class="label">
            <label>Pagamento:</label>
            <div>
                <ngx-skeleton-loader appearance="line"
                    [theme]="{height: '15px', width: '150px', 'margin-bottom': 0}">
                </ngx-skeleton-loader>
            </div>
            <div>
                <ngx-skeleton-loader appearance="line"
                    [theme]="{height: '15px', width: '150px', 'margin-bottom': 0}">
                </ngx-skeleton-loader>
            </div>
        </div>
        <div class="label">
            <label>Estado:</label>
            <div>
                <ngx-skeleton-loader appearance="line"
                    [theme]="{height: '15px', width: '150px', 'margin-bottom': 0}">
                </ngx-skeleton-loader>
            </div>
        </div>
    </mat-drawer>
    <mat-drawer-content>
        <section class="page-loading" test-id="purchase-detail-loader">
            loading...
        </section>
    </mat-drawer-content>
</mat-drawer-container>

<div *ngIf="(purchase$ | async); let purchase">
    <mat-drawer-container *ngIf="(isLoading$ | async) === false">
        <mat-drawer mode="side" opened position="start" class="hide-on-mobile">
            <div class="label">
                <label>Usuário:</label>
                <div>{{purchase?.user?.email}}</div>
            </div>
            <div class="label">
                <label>Criado em:</label>
                <div>{{purchase?.createdAt | date: 'dd/MM/yyyy HH:mm:ss'}}</div>
            </div>
            <div class="label">
                <label>Pagamento:</label>
                <div>{{purchase?.payment?.type || "" | paymentTypeName}}</div>
                <div *ngIf="purchase?.payment?.type === 'PIX' && purchase?.payment?.receiptUrl"
                    class="link" (click)="showReceipt()" test-id="receipt">
                    Ver recibo
                </div>
                <mat-error *ngIf="purchase?.payment?.error" test-id="payment-error">
                    {{purchase.payment.error}}
                </mat-error>
            </div>
            <div class="label">
                <label>Estado:</label>
                <div>
                    <select [(ngModel)]="status" (change)="changeStatus()">
                        <option value="CREATED">Solicitado</option>
                        <option value="VERIFYING_PAYMENT">Verificando pagamento</option>
                        <option value="PAID">Pago</option>
                        <option value="SORTING_OUT">Separando</option>
                        <option value="READY">Pronto</option>
                        <option value="FINISHED">Finalizado</option>
                    </select>
                </div>
            </div>
        </mat-drawer>
        <mat-drawer-content>
            <section class="page" test-id="purchase-detail">
                <mat-list role="list">
                    <mat-list-item role="listitem" *ngFor="let product of purchase.products">
                        <span class="total-product-price">
                            {{product.amount * (product.priceWithDiscount || product.price) | currency: "R$ "}}
                        </span>
                        <div mat-line>{{product.amount}}x {{product.name}}</div>
                        <div mat-line>
                            <span class="price"
                                [ngClass]="product.priceWithDiscount ? 'line-through' : ''">
                                {{product.price | currency: "R$ "}}
                            </span>
                            <span *ngIf="product.priceWithDiscount">
                                {{product.priceWithDiscount | currency: "R$ "}}
                            </span>
                        </div>
                    </mat-list-item>
                </mat-list>
                <mat-list role="list">
                    <mat-list-item role="listitem">
                        <span class="total-product-price">
                            <b>{{purchase.totalPrice | currency: "R$ "}}</b>
                        </span>
                        <div mat-line>
                            <b>
                                Total:
                                <div>
                                    {{purchase.totalAmount | number}}
                                    {{purchase.totalAmount === 1 ? 'produto' : 'produtos'}}
                                </div>
                            </b>
                        </div>
                    </mat-list-item>
                </mat-list>
            </section>
        </mat-drawer-content>
    </mat-drawer-container>
</div>